@model IEnumerable<CorpBite.Models.ViewModels.OrderViewModel>
@{
	ViewData["Title"] = "My Orders";
}

<div class="container">
	<h1 class="mb-4">My Orders</h1>

	@if (Model.Any())
	{
		<div class="row">
			<div class="col-lg-9">
				@foreach (var order in Model)
				{
					<div class="card mb-3 shadow-sm">
						<div class="card-body">
							<div class="row align-items-center">
								<div class="col-md-4">
									<h5 class="card-title mb-1">#@order.OrderNumber</h5>
									<p class="text-muted mb-0">@order.FoodCourtName</p>
									<small class="text-muted">
										@order.OrderDate.ToString("MMM dd, yyyy hh:mm tt")
									</small>
								</div>
								<div class="col-md-3">
									@if (order.IsBulkOrder)
									{
										<span class="badge bg-info me-2">Bulk Order</span>
									}
									@if (order.ScheduledTime.HasValue)
									{
										<div class="small text-muted">
											<i class="bi bi-clock"></i>
											Scheduled: @order.ScheduledTime.Value.ToString("hh:mm tt")
										</div>
									}
								</div>
								<div class="col-md-3">
									<span class="badge status-@order.OrderStatus.ToLower()">
										@order.OrderStatus
									</span>
								</div>
								<div class="col-md-2 text-md-end">
									<h6 class="mb-0">₹@order.TotalAmount.ToString("N2")</h6>
								</div>
							</div>
						</div>
						<div class="card-footer bg-transparent">
							<a asp-action="Details" asp-route-id="@order.Id"
							   class="btn btn-outline-primary btn-sm">
								View Details
							</a>
							@if (order.OrderStatus == "Pending")
							{
								<button type="button" class="btn btn-outline-danger btn-sm"
										onclick="cancelOrder(@order.Id)">
									Cancel Order
								</button>
							}
						</div>
					</div>
				}
			</div>

			<!-- Order Statistics Sidebar -->
			<div class="col-lg-3">
				<div class="card shadow-sm sticky-top" style="top: 20px;">
					<div class="card-body">
						<h5 class="card-title mb-4">Order Summary</h5>
						<div class="mb-3">
							<p class="mb-2">Total Orders</p>
							<h3>@Model.Count</h3>
						</div>
						<div class="mb-3">
							<p class="mb-2">This Month</p>
							<h3>@Model.Count(o => o.OrderDate.Month == DateTime.Now.Month)</h3>
						</div>
						<div>
							<p class="mb-2">Total Spent</p>
							<h3>₹@Model.Sum(o => o.TotalAmount).ToString("N2")</h3>
						</div>
					</div>
				</div>
			</div>
		</div>
	}
	else
	{
		<div class="text-center py-5">
			<i class="bi bi-receipt display-1 text-muted"></i>
			<h3 class="mt-3">No Orders Yet</h3>
			<p class="text-muted mb-4">Looks like you haven't placed any orders yet.</p>
			<a asp-controller="Location" asp-action="Index" class="btn btn-primary">
				Browse Food Courts
			</a>
		</div>
	}
</div>

@section Scripts {
	<script>
		function cancelOrder(orderId) {
			if (confirm('Are you sure you want to cancel this order?')) {
				$.post(`/Order/Cancel/${orderId}`)
					.done(() => {
						location.reload();
					})
					.fail(() => {
						showAlert('Failed to cancel order', 'danger');
					});
			}
		}
	</script>
}